# K3 和 K4 对比

Kibana 4 正式版 2015 年初发布，至今已近半年。但是本书依然将 Kibana 3 和 4 两个版本分别作阐述，并推荐大家同时了解两个系统。因为二者分别基于不同接口，不同目的，采取了不同的页面设计和逻辑。在不同场景下，各有优势。这里稍作解释，免受凑字骗钱之讥。

## Kibana 3 的设计思路和功能

本书一开始就提到，Kibana3 在设计之初，有另一个名字，叫 **elasticsearch dashboard**。事实上，整个 Kibana3 就是一个围绕着 dashboard 构建的单页应用。

所以，在页面逻辑上，Kibana3 异常简洁。大量的代码和逻辑，都下放到 panel 层次上。每个 panel 要独立完成自己的可视化设计、数据请求，数据处理，数据渲染。panel 和 panel 之间，则几乎毫无关联。简单一点看，整个页面就像是一堆 iframe 一样。

而 panel 的设计，则是以使用者角度来考虑的。Kibana3 尽量提供能让运维人员一步到位的使用策略。即，使用者只需要了解 panel 的配置页面能填什么参数，得到什么可视化结果。

最明显的例子，就是 trend panel。trend panel 背后，其实是针对今天和昨天，分别发起两次请求，然后再拿两次请求的结果，做一次除法，计算涨跌幅。这个除法计算，是在浏览器端完成的。

类似在浏览器端完成的，还有 histogram panel 的 hits，second 等的计算。

index 设置

## Kibana 4 的设计思路和功能
Kibana 4 提供了一系列新特性，让你在找问题，解决问题的时候前所未有的简单。它有一个全新的界面，而且优化了搜索和展示数据，构建和分析仪表板的工作流程。

## 关键特性

* 全新的数据搜索和发现界面
* 统一的可视化构建器，用以构建你喜欢和新加入的那些图表：
  * 区块图
  * 数据表格
  * 折线图
  * Markdown 文本挂件
  * 饼图(包括甜圈图)
  * 原始文档挂件
  * 单数值挂件
  * 贴片地图
  * 垂直柱状图
* 可拖拽的仪表板构建方式，让你可以快速添加，删除可视化，已经修改其大小和长宽比
* 基于聚合接口的高级分析能力，现在支持：
  * 去重统计(cardinality)
  * 非时间的直方图
  * 范围统计(Ranges)
  * 关键词(Significant terms)
  * 百分比(Percentiles)
* 基于 Lucene Expressions 的脚本化字段让你可以完成临时计算任务

## 优化

* 可以保存搜索和可视化，这样你可以再多个仪表板上链接和使用同一个搜索构建的可视化
* 可视化支持不限次数的层叠聚合，这样你可以生成新的可视化样式，比如双层甜圈图
* 替换模板化和脚本化仪表板需求的新 URL 格式
* 更好的移动端体验
* 更快的仪表板加载速度，因为我们消减了发出的 HTTP 请求数量
* 客户端请求和发往 Elasticsearch 的请求都可以有 SSL 加密
* 搜索结果高亮
* 可以很容易访问和导出可视化背后的数据：
  * 可以在表格中查看，也可以用 JSON 格式
  * 导出成 CSV 格式
  * 查看 Elasticsearch 请求和响应
* 跟仪表板一样，可以分享和嵌入独立的可视化部分

## 其他细节

* 自带网页服务器，用 Node.js 作为后端 —— 发布有 Linux，Windows 和 Mac OS 的二进制文件分发
* 用 D3 框架做可视化效果
